<!DOCTYPE html>
<html lang="en">

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="">
  <meta name="author" content="">

  <title>ESP32 Reflow Controller</title>
  
    <!-- Bootstrap core JavaScript -->
  <script src="src/jquery.min.js"></script>
  <script src="src/bootstrap.bundle.min.js"></script>

  <!-- Bootstrap core CSS -->
  <link rel="stylesheet" type="text/css" href="src/bootstrap.min.css" >

  <!-- Custom styles for this template -->
  <link href="src/simple-sidebar.css" type="text/css" rel="stylesheet">
  
   <script src="https://code.highcharts.com/highcharts.js"></script>

</head>

<body>

  <div class="d-flex" id="wrapper">

    <!-- Sidebar -->
    <div class="bg-light border-right" id="sidebar-wrapper">
      <div class="list-group list-group-flush">
        <a href="#" class="list-group-item list-group-item-action bg-light">Home</a>
        <a href="#" class="list-group-item list-group-item-action bg-light">Add profile</a>
        <a href="#" class="list-group-item list-group-item-action bg-light">Change profile</a>
        <a href="#" class="list-group-item list-group-item-action bg-light">Settings</a>
        <a href="#" class="list-group-item list-group-item-action bg-light">Info</a>
        </div>
    </div>
    <!-- /#sidebar-wrapper -->

    <!-- Page Content -->
    <div id="page-content-wrapper">

      <nav class="navbar navbar-expand-lg navbar-light bg-light border-bottom">
        <button class="btn btn-primary" id="menu-toggle">Hide Sidebar</button>

        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarSupportedContent">
          <ul class="navbar-nav ml-auto mt-2 mt-lg-0">
            <li class="nav-item active">
              <a class="nav-link" href="#">Home <span class="sr-only">(current)</span></a>
            </li>
            </ul>
        </div>
      </nav>
<div id="chart-temperature" class="container"></div>
      <div class="container-fluid">
        <h1 class="mt-4">Bootstrap 4 webpage running on ESP32</h1>
        <p>This is simple sidebar webpage running on ESP32 with ESP32 Async webserver library. </p>
        
      </div>
	  <button onclick="hideChart()">Hide chart</button>

    </div>
    <!-- /#page-content-wrapper -->

  </div>
  <!-- /#wrapper -->



  <!-- Menu Toggle Script -->
  <script>
    $("#menu-toggle").click(function(e) {
      e.preventDefault();
      $("#wrapper").toggleClass("toggled");
    });
  </script>
  
  <script>
var chartT = new Highcharts.Chart({
  chart:{ renderTo : 'chart-temperature' },
  title: { text: 'Thermocouple temperature' },
  series: [{
    showInLegend: false,
    data: []
  }],
  plotOptions: {
    line: { animation: false,
      dataLabels: { enabled: true }
    },
    series: { color: '#059e8a' }
  },
  xAxis: { type: 'datetime',
    dateTimeLabelFormats: { second: '%H:%M:%S' }
  },
  yAxis: {
    title: { text: 'Temperature (Celsius)' }
    //title: { text: 'Temperature (Fahrenheit)' }
  },
  credits: { enabled: false }
});
<!-- setInterval(function ( ) { -->
  <!-- var xhttp = new XMLHttpRequest(); -->
  <!-- xhttp.onreadystatechange = function() { -->
    <!-- if (this.readyState == 4 && this.status == 200) { -->
      <!-- var x = (new Date()).getTime(), -->
          <!-- y = parseFloat(this.responseText); -->
      <!-- //console.log(this.responseText); -->
      <!-- if(chartT.series[0].data.length > 40) { -->
        <!-- chartT.series[0].addPoint([x, y], true, true, true); -->
      <!-- } else { -->
        <!-- chartT.series[0].addPoint([x, y], true, false, true); -->
      <!-- } -->
    <!-- } -->
  <!-- }; -->
  <!-- xhttp.open("GET", "/temperature", true); -->
  <!-- xhttp.send(); -->
<!-- }, 5000 ) ; -->
if (!!window.EventSource) {
 var source = new EventSource('/events');
 
 source.addEventListener('open', function(e) {
  console.log("Events Connected");
 }, false);
 source.addEventListener('error', function(e) {
  if (e.target.readyState != EventSource.OPEN) {
    console.log("Events Disconnected");
  }
 }, false);
 
 source.addEventListener('message', function(e) {
  console.log("message", e.data);
 }, false);
 
 source.addEventListener('temperature', function(e) {
  console.log("temperature", e.data);
  //document.getElementById("temp").innerHTML = e.data;
        var x = (new Date()).getTime(),
          //y = parseFloat(this.responseText);
		  y = parseFloat(e.data);
      //console.log(this.responseText);
      if(chartT.series[0].data.length > 40) {
        chartT.series[0].addPoint([x, y], true, true, true);
      } else {
        chartT.series[0].addPoint([x, y], true, false, true);
      }
    
 }, false);
 }

</script>
<script>
function hideChart() {
  var x = document.getElementById("chart-temperature");
  if (x.style.display === "none") {
    x.style.display = "block";
  } else {
    x.style.display = "none";
  }
}
</script>
</body>

</html>
